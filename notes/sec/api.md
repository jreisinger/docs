# Authorization header

- to pass a token or credentials to the API host (provider):

```
Authorization: <type> <token/credentials>
```

Types

- Basic - uses base64-encoded credentials
- Bearer - uses an API token
- AWS-HMAC-SHA256 - uses access key and secret key

# Authentication

- process of proving and verifying an identity

## Basic authentication

- completely depends on other security controls
- credentials passed in plaintext or base64-encoded (not encrypted!) to save space
```
$ echo "username:password"|base64
dXNlcm5hbWU6cGFzc3dvcmQK
$ echo "dXNlcm5hbWU6cGFzc3dvcmQK"|base64 -d
username:password
```
- credentials may be required for every request or just once in exchange for API key or token

## API keys

- unique strings generated by providers for approved consumers
- passed in query string:
```
/api/v1/users?apikey=ju574n3x4mp134p1k3y #gitleaks:allow
```
- header:
```
"API-Secret": "17813fg8-46a7-5006-e235-45be7e9f2345" #gitleaks:allow
```
- or as a cookie:
```
Cookie: API-Key=4n07h3r4p1k3y
```
- process of acquiring API key depends on the provider, e.g. you need to register with email
- more secure than basic-auth because:
    - usually longer, more complex and random -> very difficult to brute force
    - can have expiration date to limit the time of validity

## JSON Web Tokens

1. Consumer authenticates with username/password
2. Provider generates and sends back JWT
3. Consumer adds JTW to the `Authorization` header of all requests

- three parts separated by `.`:

1. Header - algorithm used to sign the payload
2. Payload - username, timestamp, issuer
3. Signature - encrypted message used to validate the token

- generally secure but can be implemented insecurely

## HMAC

- hash-based message authentication code
- primary authn method used by AWS
- security depends on the consumer and provider keeping the secret key private

1. provider creates secret key and shares it with consumer
2. consumer applies HMAC hash function to each API request data and secret key
3. provider calculates the hash and see if it matches

- algorithms from weaker to stronger:
```
HMAC-MD5
HMAC-SHA1
HMAC-SHA256
HMAC-SHA512
```
- optimize for performance vs security

## OAuth 2.0

- standard that allows different services to access each other's data (often using APIs)
- E.g. you want share tweets on LinkedIn:
1. Authorize LinkedIn (via web GUI) to access your tweets.
2. Twitter generates a limited, time-based access token for LinkedIn.
3. LinkedIn provides the token to Twitter to post on your behalf.
- one of the most trusted forms of API authorization
- but also expands attack surface
- poor implementation can expose API providers to token injection, authorization code reuse, cross-site request forgery, invalid redirection, and phishing attacks

## No authentication

- plenty of instances to have no authn at all
- if API does not handle sensitive data and provides public info only
