<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ .Title }}</title>

<!-- Stolen from https://github.com/artyom/mdserver -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    htmlTableOfContents();
} );
function htmlTableOfContents (documentRef) {
    var documentRef = documentRef || document;
    var toc = documentRef.querySelector("nav#toc details");
    var headings = [].slice.call(documentRef.body.querySelectorAll('h1, h2, h3, h4, h5, h6'));
    //if (headings.length < 2) { return };
    headings.forEach(function (heading, index) {
        var anchor = documentRef.createElement('a');
        anchor.setAttribute('name', 'toc' + index);
        anchor.setAttribute('id', 'toc' + index);

        var link = documentRef.createElement('a');
        var ref = heading.getAttribute( "id" );
        link.setAttribute('href', '#' + ref);
        link.textContent = heading.textContent;

        var div = documentRef.createElement('div');
        div.setAttribute('class', heading.tagName.toLowerCase());

        div.appendChild(link);
        toc.appendChild(div);
        heading.parentNode.insertBefore(anchor, heading);
    });
}
</script>

<link rel="stylesheet" type="text/css" href="/static/css/style.css">

</head>

<body>

<!-- Top navigation bar: https://www.w3schools.com/howto/howto_js_topnav.asp -->
<div class="topnav">
    <a href="/about">about</a>
    <a href="/sites">sites</a>
    <a href="/blog">blog</a>
    <a href="/notes">notes</a>
    <div class="current_item"> {{$UrlPath:=.UrlPath}} ▸ {{$UrlPath}}</div>
    <div class="grep">
        <form action="/grep">
        <input type="search" placeholder="regexp" id="pattern" name="regexp">

        <input type="submit" value="grep">
        <input type="submit" value="find" formaction="/find">
        </form>
    </div>
</div>

<div class="content">

{{if (eq .Title "about")}}
<img src="/static/gopher.png" style="max-width:100%;height:auto;float:right">
{{end}}

{{if .IsDir}}

<ul style="list-style-type:disclosure-closed">
{{range .Files}}
    {{ if $UrlPath }}
        <li><a href="/{{ $UrlPath | removeTrailingSlash }}/{{ . }}">{{ . }}</a></li>
    {{ else }}
        <li><a href="{{ $UrlPath | removeTrailingSlash }}/{{ . }}">{{ . }}</a></li>
    {{ end }}
{{end}}
</ul>

✎ <a href="{{ .RepoURL }}/tree/master/data/{{ $UrlPath }}">source</a>

{{else}}

{{if and (ne .Title "about") (ne .Title "sites") (ne .Title "blog") (ne .Title "notes")}}
<p><nav id="toc"><details close><summary>Contents</summary></details></nav></p>
{{end}}

{{.Body}}

✎ <a href="{{ .RepoURL }}/tree/master/data/{{ $UrlPath }}.md">source</a>

{{end}}

</div>
</body>

</html>
